## Codebase Patterns
- Use `uv run mypy src/` to typecheck the project
- All functions must have return type annotations for strict mypy
- Database module is at `src/booktok/database.py` with `initialize_database()` function
- Use `uv sync` and `uv add` for dependency management
- Data models are in `src/booktok/models.py` with enums: BookStatus, FileType, Frequency
- All dataclasses have `validate()` method and call it in `__post_init__()`
- Repository pattern: use `DatabaseConnectionManager` from `src/booktok/repository.py`
- Use `with db.transaction()` context manager for write operations (auto commit/rollback)
- SQLite stores booleans as INTEGER (0/1) - convert when reading rows

---

## 2026-01-10 - US-001
Thread: https://ampcode.com/threads/T-019ba8e3-1cce-72a9-877a-200b1a225c86
- What was implemented:
  - Updated pyproject.toml with all required dependencies
  - Created SQLite database initialization script with full schema
  - Fixed main.py to have proper type annotations
- Files changed:
  - pyproject.toml - Added dependencies and mypy config
  - src/booktok/database.py - New file with database initialization
  - src/main.py - Added return type annotation
- **Learnings for future iterations:**
  - Project uses strict mypy configuration - all functions need type annotations
  - Database schema includes: users, books, snippets, user_progress, delivery_schedules
  - Tables use INTEGER for booleans (is_completed, is_paused)
---

## 2026-01-10 - US-002
Thread: https://ampcode.com/threads/T-019ba8e5-1636-73eb-a6be-37164bcce51c
- What was implemented:
  - Created data model dataclasses for User, Book, Snippet, UserProgress, DeliverySchedule
  - Added enums for BookStatus, FileType, and Frequency
  - Implemented validate() method for each dataclass
  - All models use __post_init__ for automatic validation
- Files changed:
  - src/booktok/models.py - New file with all data models
- **Learnings for future iterations:**
  - Use Enum types for constrained choices (BookStatus, FileType, Frequency)
  - ValidationError is a custom exception in models.py
  - delivery_time format is "HH:MM" (24-hour format)
  - Database IDs are Optional[int] since they're set by DB on insert
---

## 2026-01-10 - US-003
Thread: https://ampcode.com/threads/T-019ba8e6-aecb-73e2-9e15-b9ec393af3c5
- What was implemented:
  - Created DatabaseConnectionManager with context manager for transactions
  - Implemented UserRepository with full CRUD + get_by_telegram_id
  - Implemented BookRepository with CRUD + list_by_status
  - Implemented SnippetRepository with CRUD + bulk create, get_by_book_and_position
  - Implemented UserProgressRepository with CRUD + get_by_user_and_book
  - Implemented DeliveryScheduleRepository with CRUD + list_pending_deliveries
  - Created MigrationManager for database version tracking
- Files changed:
  - src/booktok/repository.py - New file with all repositories
- **Learnings for future iterations:**
  - All repositories use DatabaseConnectionManager for shared connection handling
  - Use `with db.transaction()` for write operations (auto commit/rollback)
  - SQLite stores booleans as INTEGER (0/1) - convert in row_to_model methods
  - datetime values stored as ISO format strings, parse with fromisoformat()
  - MigrationManager tracks applied migrations in `migrations` table
---

## 2026-01-10 - US-004
Thread: https://ampcode.com/threads/T-019ba8e9-8dfb-7368-93a9-69385ec26836
- What was implemented:
  - Created BookProcessor class with PDF text extraction using PyPDF2
  - Implemented multi-page PDF handling with page-by-page extraction
  - Text cleaning/normalization (whitespace, line breaks, hyphenation fix)
  - Custom exceptions: BookProcessingError, InvalidFileError, UnsupportedFileTypeError
  - Updated __init__.py to export new classes
- Files changed:
  - src/booktok/book_processor.py - New file with PDF extraction logic
  - src/booktok/__init__.py - Added exports for book processor classes
- **Learnings for future iterations:**
  - PyPDF2 uses PdfReader class (not PdfFileReader in v3+)
  - PdfReadError is in PyPDF2.errors module
  - Image-based PDFs won't yield text - need to detect and report this
  - Hyphenation across lines is handled by regex: r"(\w)-\s*\n\s*(\w)" -> r"\1\2"
---
